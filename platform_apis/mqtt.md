# AWS IoT and MQTT

Care Daily supports [AWS IoT Core](https://docs.aws.amazon.com/iot/latest/developerguide/what-is-aws-iot.html) to send devices data to the cloud and receive commands and configuration settings from Care Daily services.
AWS IoT Core supports connection with devices over [MQTT 3 and 5 proptocol](https://docs.aws.amazon.com/iot/latest/developerguide/mqtt.html), MQTT over WebSocket, HTTP.

## Devices Authentication and Authorization

Care Daily recommends using [X.509 certificates](https://docs.aws.amazon.com/iot/latest/developerguide/x509-client-certs.html) to authenticate device connections to AWS IoT.

A X.509 certificate generated by Care Daily includes an attached [AWS IoT policy](https://docs.aws.amazon.com/iot/latest/developerguide/iot-policies.html),
which specifies how a device can connect and to which MQTT topics it can publish data and subscribe.
Usually the publish and subscribe MQTT topics filer in the policy is set as a combination of the device type specific prefix and the device ID and ended by `*`: `YourDeviceTypePrefix/DeviceID/*`.
This filter guaranties that the device can publish and subscribe only to own MQTT topics.

In addition Care Daily supports [Custom authentication and authorization](https://docs.aws.amazon.com/iot/latest/developerguide/custom-authentication.html) by a username and a password.
This method dynamically generates IoT policy on each device's connection.

## AWS IoT connection settings

Care Daily provides the [Get Connection Server API](https://iotapps.docs.apiary.io/#reference/cloud-connectivity/server-instances/get-server).
Using this API a device can obtain all required AWS IoT connection information in one API call:

* AWS IoT endpoint, which includes host, port, and TLS version.
* Amazon root CA certificate.
* Device's [X.509 certificate and a private key](https://docs.aws.amazon.com/iot/latest/developerguide/x509-client-certs.html) generated by AWS IoT with an attached [AWS IoT policy](https://docs.aws.amazon.com/iot/latest/developerguide/iot-policies.html).
* MQTT Client ID as it is set in the IoT policy, and which is equal to the device ID by default.
* Device's publish and subscribe MQTT topics prefix as specified in the IoT policy.
* Quality of Service, which is at least once (QOS1) by default.


## AWS IoT Device SDKs

The [AWS IoT Device SDKs](https://docs.aws.amazon.com/iot/latest/developerguide/iot-connect-devices.html#iot-connect-device-sdks) provide language-specific support for MQTT and WebSocket Secure (WSS) protocols, which devices use to communicate with AWS IoT.

## MQTT retained messages

Care Daily supports sending commands and configuration settings to devices in [MQTT retained messages](https://docs.aws.amazon.com/iot/latest/developerguide/mqtt.html#mqtt-retain).